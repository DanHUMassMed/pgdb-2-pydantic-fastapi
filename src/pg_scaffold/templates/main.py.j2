
import os
import logging
from fastapi import FastAPI, HTTPException
from fastapi.middleware.cors import CORSMiddleware
from dotenv import load_dotenv
import debugpy
from app.api.v1 import conferences, attendees

load_dotenv() 
REACT_APP_URL = os.getenv("REACT_APP_URL", "http://localhost:3000")
API_VERSION_STR = os.getenv("API_VERSION_STR", "/api/v1")


# Configure logging
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

ACTIVATE_DEBUG = os.getenv("ACTIVATE_DEBUG", "FALSE")
if ACTIVATE_DEBUG=="TRUE":
    debugpy.listen(("0.0.0.0", 58979))
    logger.info("Waiting for debugger to attach...")


app = FastAPI(title="Poster Judging App",
              openapi_url=f"{API_VERSION_STR}/openapi.json")

# CORS middleware
app.add_middleware(
    CORSMiddleware,
    allow_origins=[f"{REACT_APP_URL}"],  # Allows frontend to connect
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)


app.include_router(conferences.router, prefix=API_VERSION_STR, tags=["conferences"])
app.include_router(attendees.router, prefix=API_VERSION_STR, tags=["attendees"])

@app.get("/")
def read_root():
    return {"message": "Welcome to the Poster Judging API"}